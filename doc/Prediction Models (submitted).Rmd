---
title: "Prediction Models"
author: "Jingwen Yin jy2786"
date: "April 24, 2017"
output: pdf_document
---
```{r, warning=FALSE, message=FALSE}
library(rpart)
library(party)
library(randomForest)
library(gamboostLSS)
library(e1071)
library(foreach)
library(mlbench)
library(caret)
```

# GPA
```{r, message=FALSE, warning=FALSE}
data.filtered <- read.csv('../data/NAreplaced.csv') #4242 1388
select <- read.csv('../data/Updated_Features/gpa_features.csv')
data.filtered <- data.filtered[,select$Codes] # 4242*64

label <- read.csv('../data/train.csv')
label<-na.omit(label)
Index<-data.filtered$challengeID %in% label$challengeID

data.train<-data.filtered[Index,]
data.train<-as.data.frame(data.train)
data.train<-cbind(label$gpa, data.train)
colnames(data.train)[1]<-"gpa"

control <- trainControl(method="repeatedcv", number=10, repeats=3)
seed <- 7
metric <- "RMSE"
# Stochastic Gradient Boosting
set.seed(seed)
fit.gbm <- train(gpa~., data=data.train, method="gbm", metric=metric, trControl=control, verbose=FALSE)
gpa_prediction<-predict(fit.gbm, data.filtered)
```

# Grit
```{r, message=FALSE, warning=FALSE}
data.filtered <- read.csv('../data/NAreplaced.csv') 
select <- read.csv('../data/Updated_Features/grit_features.csv')
data.filtered <- data.filtered[,select$Codes] 

data.train<-data.filtered[Index,]
data.train<-as.data.frame(data.train)
data.train<-cbind(label$grit, data.train)
colnames(data.train)[1]<-"grit"

# gamboostLSS
lmLSS <- glmboostLSS(grit~., data=data.train)
grit_prediction<- predict(lmLSS,data.filtered)[[1]]
```

# materialHardship
```{r, message=FALSE, warning=FALSE}
data.filtered <- read.csv('../data/NAreplaced.csv') 
select <- read.csv('../data/Updated_Features/materialHardship_features.csv')
data.filtered <- data.filtered[,select$Codes] 

data.train<-data.filtered[Index,]
data.train<-as.data.frame(data.train)
data.train<-cbind(label$materialHardship, data.train)
colnames(data.train)[1]<-"materialHardship"

# Stochastic Gradient Boosting
fit.gbm <- train(materialHardship~., data=data.train, method="gbm", metric=metric, trControl=control, verbose=FALSE)
materialHardship_prediction<-predict(fit.gbm, data.filtered)
```

# eviction
```{r, message=FALSE, warning=FALSE}
data.filtered <- read.csv('../data/NAreplaced.csv') 
select <- read.csv('../data/Updated_Features/eviction_features.csv')
data.filtered <- data.filtered[,select$Codes] 

data.train<-data.filtered[Index,]
data.train<-as.data.frame(data.train)
data.train<-cbind(label$eviction, data.train)
colnames(data.train)[1]<-"eviction"

# Full Tree
rt <- rpart(factor(eviction)~., data=data.train, method = "class")
eviction_prediction<-ifelse(predict(rt,data.filtered)[,1]>=predict(rt,data.filtered)[,2], 0, 1)
```

# layoff
```{r, message=FALSE, warning=FALSE}
data.filtered <- read.csv('../data/NAreplaced.csv') 
select <- read.csv('../data/Updated_Features/layoff_features.csv')
data.filtered <- data.filtered[,select$Codes] 

data.train<-data.filtered[Index,]
data.train<-as.data.frame(data.train)
data.train<-cbind(label$layoff, data.train)
colnames(data.train)[1]<-"layoff"

metric <- "Accuracy"
# lda
fit.lda <- train(factor(layoff)~., data=data.train, method="lda", metric=metric, trControl=control)
layoff_prediction<-predict(fit.lda, data.filtered)
```

# jobTraining
```{r, message=FALSE, warning=FALSE}
data.filtered <- read.csv('../data/NAreplaced.csv') 
select <- read.csv('../data/Updated_Features/jobTraining_features.csv')
data.filtered <- data.filtered[,select$Codes] 

data.train<-data.filtered[Index,]
data.train<-as.data.frame(data.train)
data.train<-cbind(label$jobTraining, data.train)
colnames(data.train)[1]<-"jobTraining"

# Random Forest
rf <- randomForest(factor(jobTraining)~., data = data.train)
jobTraining_prediction<-predict(rf, data.filtered)
```

```{r}
result<-data.frame(c(1:4242),gpa_prediction, grit_prediction, materialHardship_prediction, eviction_prediction, layoff_prediction, jobTraining_prediction)
colnames(result)<-colnames(label)
write.csv(result, "prediction.csv", row.names = FALSE)
```


