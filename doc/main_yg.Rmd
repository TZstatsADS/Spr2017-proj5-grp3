---
title: "R Notebook"
output: html_notebook
---



Step 0: load the raw data, load the age 9 features, extract age 9 data
```{r}
library(data.table)

load("~/GitHub/Spr2017-proj5-grp3/data/background.RData")
#raw=read.csv("~/Documents/FFChallenge/background.csv",header=TRUE)
features<-colnames(background)

codebooks<-c("child","mom","dad","teacher")
data.info<-vector()

for (i in codebooks){
feat.table<-read.csv(paste0("~/GitHub/Spr2017-proj5-grp3/data/ff_",i,"_cb9.csv"),header=FALSE)
feat.table<-feat.table[,-1]
feat.table<-feat.table[-1,]
feat.table<-cbind(rep(i,nrow(feat.table)),feat.table)
data.info<-rbind(data.info,feat.table)
}

colnames(data.info)<-c("class","code","description")
data.info=as.data.frame(data.info)
featnum<-nrow(data.info)

extract.feature<-features %in% data.info$code  
sum(extract.feature)


extract.data<-background[,extract.feature]
extract.data<-cbind(challengeID=background[,1],extract.data)

#remove columns with NA, -9, -6 values count for more than 80%
ED<-as.data.table(extract.data)
obs<-nrow(extract.data)

ED=ED[,which(unlist(lapply(ED, function(x)!(sum(is.na(x))/obs>=0.5)))),with=F]
ED=ED[,which(unlist(lapply(ED, function(x)!(sum(x %in% c("-9","-6","-3"))/obs>=0.5)))),with=F]

#replace "-9","-6","-3" with NA
extract.data<-as.data.frame(ED)
extract.data[ extract.data == "-9"| extract.data == "-6"|extract.data == "-3"]<-NA

cols=ncol(extract.data)
#remove rows with NA values count for more than 70%
extract.data <- extract.data[ apply(extract.data, 1, function(x){!sum(is.na(x))/cols>=0.5}),]


###################################
#try this trick out in the whole background data
#BG<-as.data.table(background)
#BG_1=BG[,which(unlist(lapply(BG, function(x)!(sum(is.na(x))/obs>=0.8)))),with=F]
#BG_1=BG[,which(unlist(lapply(BG, function(x)!(sum(x %in% c("-9","-6"))/obs>=0.8)))),with=F]

#write.csv(extract.data,file = "~/GitHub/Spr2017-proj5-grp3/data/extractdata.csv")
```


```{r}
label<-read.csv("~/Documents/FFChallenge/train.csv")

label.train<-label[,1:2]
label.train=na.omit(label.train)
trainIndex=extract.data$challengeID %in% label.train$challengeID
data.train<-extract.data[trainIndex,]
data.train<-as.data.frame(data.train)

```


```{r}
library(e1071)
library(tree)
library(caret)


#set.seed (1)
i.train = sample(1:nrow(data.train), nrow(data.train)*0.9)
dtrain=data.train[i.train,]
dtest=data.train[-i.train,]
ltrain=label.train$gpa[i.train]

dt=cbind(ltrain,dtrain[,-1])
dt=as.data.frame(dt)

tree.ff=tree(ltrain~.,dtrain)

cv.d <- cv.tree(tree.boston,FUN = prune.misclass)
prune.d <- prune.misclass(tree.boston,best = 7)
tree.pred <- predict(prune.d,subset(dtest,select=-y), type = "class")
error <- mean(tree.pred != dtest$y)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).
